--===[ KEY SYSTEM ]===--
local validKey = "Asr_Production" -- ganti sesuai keinginan

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local RunService = game:GetService("RunService")

-- GUI Key
local KeyGui = Instance.new("ScreenGui")
KeyGui.Name = "KeySystem"
KeyGui.Parent = PlayerGui
KeyGui.ResetOnSpawn = false

local KeyFrame = Instance.new("Frame")
KeyFrame.Size = UDim2.new(0, 250, 0, 120)
KeyFrame.Position = UDim2.new(0.5, -125, 0.5, -60)
KeyFrame.BackgroundColor3 = Color3.new(0, 0, 0)
KeyFrame.BorderSizePixel = 0
KeyFrame.Parent = KeyGui

local KeyTitle = Instance.new("TextLabel")
KeyTitle.Size = UDim2.new(1, 0, 0, 30)
KeyTitle.Text = "Enter Key to Access ESP"
KeyTitle.TextColor3 = Color3.new(1, 1, 1)
KeyTitle.TextScaled = true
KeyTitle.Font = Enum.Font.SourceSansBold
KeyTitle.BackgroundTransparency = 1
KeyTitle.Parent = KeyFrame

local KeyBox = Instance.new("TextBox")
KeyBox.Size = UDim2.new(1, -20, 0, 30)
KeyBox.Position = UDim2.new(0, 10, 0, 40)
KeyBox.PlaceholderText = "Enter Key..."
KeyBox.Text = ""
KeyBox.TextColor3 = Color3.new(1, 1, 1)
KeyBox.BackgroundColor3 = Color3.new(0.15, 0.15, 0.15)
KeyBox.Font = Enum.Font.SourceSans
KeyBox.TextScaled = true
KeyBox.Parent = KeyFrame

local Submit = Instance.new("TextButton")
Submit.Size = UDim2.new(1, -20, 0, 30)
Submit.Position = UDim2.new(0, 10, 0, 80)
Submit.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
Submit.TextColor3 = Color3.new(1, 1, 1)
Submit.Text = "Submit"
Submit.Font = Enum.Font.SourceSansBold
Submit.TextScaled = true
Submit.Parent = KeyFrame

-- kata tidak senonoh sederhana (filter manual)
local badWords = {"anj", "tolol", "goblok", "memek", "kontol"}

Submit.MouseButton1Click:Connect(function()
    if KeyBox.Text == validKey then
        KeyGui:Destroy()

        -- GUI Utama
        local ScreenGui = Instance.new("ScreenGui")
        ScreenGui.Name = "ESP_GUI"
        ScreenGui.ResetOnSpawn = false
        ScreenGui.Parent = PlayerGui

        local Frame = Instance.new("Frame")
        Frame.Size = UDim2.new(0, 200, 0, 160)
        Frame.Position = UDim2.new(0, 20, 0, 100)
        Frame.BackgroundColor3 = Color3.new(0, 0, 0)
        Frame.BorderSizePixel = 0
        Frame.Active = true
        Frame.Draggable = true
        Frame.Parent = ScreenGui

        -- Judul
        local Title = Instance.new("TextLabel")
        Title.Size = UDim2.new(1, 0, 0, 30)
        Title.Text = "AFZ ESP"
        Title.TextColor3 = Color3.new(1, 1, 1)
        Title.TextScaled = true
        Title.Font = Enum.Font.SourceSansBold
        Title.BackgroundTransparency = 1
        Title.Parent = Frame

        -- Toggle AFZ
        local ToggleAFZ = Instance.new("TextButton")
        ToggleAFZ.Size = UDim2.new(1, -10, 0, 30)
        ToggleAFZ.Position = UDim2.new(0, 5, 0, 35)
        ToggleAFZ.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
        ToggleAFZ.TextColor3 = Color3.new(1, 1, 1)
        ToggleAFZ.Text = "AFZ ESP: OFF"
        ToggleAFZ.Font = Enum.Font.SourceSans
        ToggleAFZ.TextScaled = true
        ToggleAFZ.Parent = Frame

        -- Toggle Sus
        local ToggleSus = Instance.new("TextButton")
        ToggleSus.Size = UDim2.new(1, -10, 0, 30)
        ToggleSus.Position = UDim2.new(0, 5, 0, 70)
        ToggleSus.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
        ToggleSus.TextColor3 = Color3.new(1, 1, 1)
        ToggleSus.Text = "Sus ESP: OFF"
        ToggleSus.Font = Enum.Font.SourceSans
        ToggleSus.TextScaled = true
        ToggleSus.Parent = Frame

        -- Credit
        local Credit = Instance.new("TextLabel")
        Credit.Size = UDim2.new(1, -10, 0, 20)
        Credit.Position = UDim2.new(0, 5, 0, 110)
        Credit.BackgroundTransparency = 1
        Credit.Text = "Dark sistem"
        Credit.TextColor3 = Color3.new(1, 0, 0)
        Credit.TextScaled = true
        Credit.Font = Enum.Font.SourceSansBold
        Credit.TextXAlignment = Enum.TextXAlignment.Center
        Credit.Parent = Frame

        local Support = Instance.new("TextLabel")
        Support.Size = UDim2.new(1, -10, 0, 20)
        Support.Position = UDim2.new(0, 5, 0, 135)
        Support.BackgroundTransparency = 1
        Support.Text = "Supported by ASR | Script Production"
        Support.TextColor3 = Color3.new(1, 1, 1)
        Support.TextScaled = true
        Support.Font = Enum.Font.SourceSans
        Support.TextXAlignment = Enum.TextXAlignment.Center
        Support.Parent = Frame

        -- Animasi RGB untuk credit
        spawn(function()
            while task.wait(0.2) do
                Credit.TextColor3 = Color3.fromHSV(tick() % 5 / 5, 1, 1)
            end
        end)

        -- Variabel
        local afzEnabled = false
        local susEnabled = false
        local espObjects = {}

        local function clearESP(typeName)
            for player, obj in pairs(espObjects) do
                if obj.type == typeName then
                    if obj.label then obj.label:Destroy() end
                    espObjects[player] = nil
                end
            end
        end

        -- toggle
        ToggleAFZ.MouseButton1Click:Connect(function()
            afzEnabled = not afzEnabled
            ToggleAFZ.Text = afzEnabled and "AFZ ESP: ON" or "AFZ ESP: OFF"
            if not afzEnabled then clearESP("afz") end
        end)
        ToggleSus.MouseButton1Click:Connect(function()
            susEnabled = not susEnabled
            ToggleSus.Text = susEnabled and "Sus ESP: ON" or "Sus ESP: OFF"
            if not susEnabled then clearESP("sus") end
        end)

        -- Chat detection
        local SusPlayers = {}
        local function listenChat(player)
            player.Chatted:Connect(function(msg)
                local lowerMsg = string.lower(msg)
                for _, word in ipairs(badWords) do
                    if string.find(lowerMsg, word) then
                        SusPlayers[player] = true
                    end
                end
            end)
        end
        for _, plr in pairs(Players:GetPlayers()) do
            if plr ~= LocalPlayer then
                listenChat(plr)
            end
        end
        Players.PlayerAdded:Connect(function(plr)
            if plr ~= LocalPlayer then
                listenChat(plr)
            end
        end)

        -- ESP Loop
        RunService.RenderStepped:Connect(function()
            -- AFZ ESP
            if afzEnabled then
                for _, player in pairs(Players:GetPlayers()) do
                    if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                        if string.sub(string.lower(player.Name),1,3) == "afz" or string.sub(string.lower(player.Name),-3) == "afz" then
                            local hrp = player.Character.HumanoidRootPart
                            local distance = (LocalPlayer.Character.HumanoidRootPart.Position - hrp.Position).Magnitude
                            local esp = espObjects[player]
                            if not esp or esp.type ~= "afz" then
                                if esp then esp.label:Destroy() end
                                local textLabel = Instance.new("BillboardGui")
                                textLabel.Adornee = hrp
                                textLabel.Size = UDim2.new(0,200,0,50)
                                textLabel.StudsOffset = Vector3.new(0,3,0)
                                textLabel.AlwaysOnTop = true
                                textLabel.Parent = hrp

                                local label = Instance.new("TextLabel")
                                label.Size = UDim2.new(1,0,1,0)
                                label.BackgroundTransparency = 1
                                label.TextColor3 = Color3.new(0,1,0)
                                label.TextScaled = true
                                label.Font = Enum.Font.SourceSansBold
                                label.Text = "[AFZ] "..player.Name.." | "..math.floor(distance).."m"
                                label.Parent = textLabel

                                espObjects[player] = {type="afz",label=label}
                            else
                                esp.label.Text = "[AFZ] "..player.Name.." | "..math.floor(distance).."m"
                            end
                        end
                    end
                end
            end

            -- Sus ESP
            if susEnabled then
                for player,_ in pairs(SusPlayers) do
                    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                        local hrp = player.Character.HumanoidRootPart
                        local distance = (LocalPlayer.Character.HumanoidRootPart.Position - hrp.Position).Magnitude
                        local esp = espObjects[player]
                        if not esp or esp.type ~= "sus" then
                            if esp then esp.label:Destroy() end
                            local textLabel = Instance.new("BillboardGui")
                            textLabel.Adornee = hrp
                            textLabel.Size = UDim2.new(0,200,0,60)
                            textLabel.StudsOffset = Vector3.new(0,4,0)
                            textLabel.AlwaysOnTop = true
                            textLabel.Parent = hrp

                            local title = Instance.new("TextLabel")
                            title.Size = UDim2.new(1,0,0.5,0)
                            title.BackgroundTransparency = 1
                            title.TextColor3 = Color3.new(1,0,0)
                            title.TextScaled = true
                            title.Font = Enum.Font.SourceSansBold
                            title.Text = "Sus player detected"
                            title.Parent = textLabel

                            local label = Instance.new("TextLabel")
                            label.Size = UDim2.new(1,0,0.5,0)
                            label.Position = UDim2.new(0,0,0.5,0)
                            label.BackgroundTransparency = 1
                            label.TextColor3 = Color3.new(1,1,0)
                            label.TextScaled = true
                            label.Font = Enum.Font.SourceSansBold
                            label.Text = player.Name.." | "..math.floor(distance).."m"
                            label.Parent = textLabel

                            espObjects[player] = {type="sus",label=textLabel}
                        else
                            esp.label.Text = player.Name.." | "..math.floor(distance).."m"
                        end
                    end
                end
            end
        end)
    else
        KeyBox.Text = ""
        KeyBox.PlaceholderText = "Wrong key!"
    end
end)
